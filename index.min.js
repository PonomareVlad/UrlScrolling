"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isScrolledIntoView=isScrolledIntoView;exports.debounce=debounce;exports.default=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var UrlScroll=function(){function UrlScroll(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$scrollNode=_ref.scrollNode,scrollNode=_ref$scrollNode===void 0?document:_ref$scrollNode,_ref$pathAttribute=_ref.pathAttribute,pathAttribute=_ref$pathAttribute===void 0?"id":_ref$pathAttribute,_ref$headerSection=_ref.headerSection,headerSection=_ref$headerSection===void 0?true:_ref$headerSection,_ref$scrollEventDelay=_ref.scrollEventDelay,scrollEventDelay=_ref$scrollEventDelay===void 0?20:_ref$scrollEventDelay,_ref$debug=_ref.debug,debug=_ref$debug===void 0?false:_ref$debug;_classCallCheck(this,UrlScroll);this.options={scrollNode:scrollNode instanceof Node?scrollNode:document.querySelector(scrollNode),pathAttribute:pathAttribute,headerSection:headerSection,scrollEventDelay:scrollEventDelay,debug:debug};this.attachConsoleProxy();this.listenEvent("popstate",this.routingHandler);document.readyState==="complete"?this.init():this.listenEvent("load",this.init)}_createClass(UrlScroll,[{key:"init",value:function init(){this.loadSectionsList();this.routingHandler();this.listenEvent("scroll",this.scrollEventHandler,this.options.scrollNode)}},{key:"routingHandler",value:function routingHandler(event){this.console.debug("Routing start",event);this.disableScrollEvent();var targetPath=this.currentStateData(event).sectionPath||this.currentPath();var targetSectionNode=this.options.scrollNode.querySelector("[".concat(this.options.pathAttribute,"=\"").concat(targetPath,"\"]"));targetSectionNode?this.asyncThread(function(){return targetSectionNode.scrollIntoView()}):this.asyncThread(function(){return document.body.scrollTo(0,0)});if(targetSectionNode)this.console.debug("Scrolled to ".concat(targetPath),targetSectionNode)}},{key:"scrollEventHandler",value:function scrollEventHandler(){var _this=this;return debounce(function(){if(_this.disabledScrollEvent)return;var historyChanged=false;_this.sectionsList.forEach(function(sectionNode){if(historyChanged)return;if(!isScrolledIntoView(sectionNode))return;historyChanged=true;var sectionPath=sectionNode.getAttribute(_this.options.pathAttribute);if(!_this.checkPath(sectionPath))return;_this.console.log("Section changed to: ".concat(sectionPath));return _this.changeState({sectionPath:sectionPath})});if(!historyChanged)return _this.headerState()},this.options.scrollEventDelay)()}},{key:"headerState",value:function headerState(){if(!this.options.headerSection||!this.currentStateData().sectionPath)return false;this.console.log("Changed to Header");return this.changeState()}},{key:"changeState",value:function changeState(){var stateData=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{history.pushState(stateData,null,stateData.sectionPath||"/")}catch(e){this.console.error("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u043E\u0432\u044B\u0441\u0438\u0442\u044C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0437\u0430\u0434\u0435\u0440\u0436\u043A\u0438 \u0442\u0440\u043E\u0442\u0442\u043B\u0438\u043D\u0433\u0430 (throttleDelay)",e)}}},{key:"asyncThread",value:function asyncThread(func){return setTimeout(func,1)}},{key:"checkPath",value:function checkPath(sectionPath){if(history.state&&history.state.sectionPath===""&&history.state.sectionPath===sectionPath)return false;if(history.state&&history.state.sectionPath&&history.state.sectionPath===sectionPath)return false;return true}},{key:"currentStateData",value:function currentStateData(event){return event&&event.state?event.state:history.state||{}}},{key:"disableScrollEvent",value:function disableScrollEvent(){var _this2=this;var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.options.scrollEventDelay*2;this.disabledScrollEvent=true;setTimeout(function(){return _this2.disabledScrollEvent=false},delay)}},{key:"currentPath",value:function currentPath(){var pathname=arguments.length>0&&arguments[0]!==undefined?arguments[0]:location.pathname;return pathname[0]==="/"?pathname.substr(1):pathname}},{key:"loadSectionsList",value:function loadSectionsList(){this.sectionsList=this.options.scrollNode.querySelectorAll("[".concat(this.options.pathAttribute,"]"));this.console.debug("".concat(this.sectionsList.length," sections loaded"),this.sectionsList)}},{key:"listenEvent",value:function listenEvent(event,listener){var target=arguments.length>2&&arguments[2]!==undefined?arguments[2]:window;return target.addEventListener.call(target,event,listener.bind(this))}},{key:"attachConsoleProxy",value:function attachConsoleProxy(){var _this3=this;this.console=["log","debug","error"].reduce(function(proxyObject,method){return(proxyObject[method]=function(){var _console$method;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _this3.options.debug?(_console$method=console[method]).call.apply(_console$method,[console].concat(args)):null})&&proxyObject},{})}}]);return UrlScroll}();exports.default=UrlScroll;function isScrolledIntoView(elementNode){var rect=elementNode.getBoundingClientRect();var elemTop=rect.top;var elemBottom=rect.bottom;var halfWindowHeight=parseInt(window.innerHeight/2);return elemTop<=halfWindowHeight+1&&elemBottom>=halfWindowHeight-1}function debounce(func,wait){var timeout;return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var context=this;clearTimeout(timeout);timeout=setTimeout(function(){return func.apply(context,args)},wait)}}window.UrlScroll=UrlScroll;

//# sourceMappingURL=index.min.js.map