{"version":3,"sources":["../urlScroll.mjs"],"names":["UrlScroll","rootNode","document","attribute","headerSection","throttleDelay","debug","disabledScrollEvent","Node","querySelector","console","consoleMethods","window","addEventListener","routingHandler","bind","readyState","init","sectionsList","querySelectorAll","debounce","scrollEventHandler","log","sectionChanged","forEach","section","isScrolledIntoView","targetSection","getAttribute","history","state","stateData","pushState","e","error","event","disableScrollEvent","currentState","location","pathname","targetSectionNode","setTimeout","body","scrollTo","scrollIntoView","timeout","args","call","elementNode","rect","getBoundingClientRect","elemTop","top","elemBottom","bottom","halfWindowHeight","parseInt","innerHeight","func","wait","context","clearTimeout","apply"],"mappings":"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","sourcesContent":["export default class UrlScroll {\n\n    constructor({rootNode = document, attribute = 'id', headerSection = true, throttleDelay = 20, debug = false} = {}) {\n        // Установка переменных\n        this.attribute = attribute; // Аттрибут блока для поиска путей\n        this.throttleDelay = throttleDelay; // Задержка вызова события прокрутки\n        this.debug = debug; // Отображение лога\n        this.headerSection = headerSection; // Обработка перехода в шапку сайта, как шаг в истории\n        this.disabledScrollEvent = false;\n        this.rootNode = rootNode instanceof Node ? rootNode : document.querySelector(rootNode); // Выборка DOM узла, если получен селектор\n        this.console = this.consoleMethods(); // Прокси для консольных методов (Сообщения выводятся только при debug = true)\n        window.addEventListener('popstate', this.routingHandler.bind(this)); // Событие перемещения по истории (Назад, Вперед)\n        if (document.readyState === 'complete') this.init(); // Если страница уже загружена (При динамическом импорте)\n        else window.addEventListener('load', this.init.bind(this)); // Если страница загружется, ждем события onload\n    }\n\n    init() {\n        this.sectionsList = this.rootNode.querySelectorAll(`[${this.attribute}]`); // Кэшируем список блоков, участвующих в смене URL\n        this.rootNode.addEventListener('scroll', UrlScroll.debounce(this.scrollEventHandler.bind(this), this.throttleDelay)); // Событие прокрутки страницы\n        this.routingHandler(); // Запуск маршрутизации\n    }\n\n    scrollEventHandler() {\n        if (this.disabledScrollEvent) return this.console.log('Scroll event skipped');\n        let sectionChanged = false;\n        this.sectionsList.forEach( // Перебираем список блоков\n            section => {\n                if (sectionChanged) return;\n                if (!UrlScroll.isScrolledIntoView(section)) return; // Проверка попадания блока в зону видимости\n                sectionChanged = true;\n                let targetSection = section.getAttribute(this.attribute); // Получаем значение аттрибута\n                if (history.state && history.state.section === '' && history.state.section === targetSection) return; // URL и значение аттрибута пустое\n                if (history.state && history.state.section && history.state.section === targetSection) return; // URL и значение аттрибута идентичны\n                try {\n                    let stateData = {section: targetSection};\n                    this.console.debug('PushState', stateData, targetSection);\n                    history.pushState({section: targetSection}, null, targetSection); // Добавляем новый шаг в историю согласно значению аттрибута\n                    this.console.log(`Section changed to: ${targetSection}`)\n                } catch (e) {\n                    this.console.error('Необходимо повысить значение задержки троттлинга (throttleDelay)', e) // Данное ограничение присутствует в Safari\n                }\n            }\n        );\n        if (this.headerSection && !sectionChanged) if (history.state && history.state.section) { // Переход на первый экран страницы, в случае если над первой секцией есть меню или контент\n            history.pushState({section: false}, null, '/');\n            this.console.log('Changed to Header');\n        }\n    }\n\n    routingHandler(event = null) {\n        this.console.debug('Routing start', event);\n        this.disableScrollEvent(); // Отключем событие прокрутки, чтобы не создавались лишние шаги в истории\n        let currentState = event && event.state ? event.state : history.state;\n        let targetSection = currentState && currentState.section ? currentState.section : location.pathname; // Целевой путь\n        let targetSectionNode = this.rootNode.querySelector(`[${this.attribute}=\"${targetSection}\"]`); // Блок ассоциированный с целевым путем\n        if (!targetSectionNode) return setTimeout(() => document.body.scrollTo(0, 0), 1); // Если блок не найден, возвращаемся в начало страницы\n        setTimeout(() => targetSectionNode.scrollIntoView(), 1); // Прокручиваем страницу к целевому блоку, используя отдельный поток\n        this.console.debug(`Scrolled to ${targetSection}`, targetSectionNode);\n        return true;\n    }\n\n    disableScrollEvent(timeout = this.throttleDelay * 2) { // Отключие события прокрутки\n        this.disabledScrollEvent = true;\n        this.console.log('Scroll Event disabled');\n        setTimeout(() => {\n            this.disabledScrollEvent = false;\n            this.console.log('Scroll Event enabled')\n        }, timeout);\n    }\n\n    consoleMethods() { // Прокси для консольных методов (Сообщения выводятся только при debug = true)\n        return {\n            log: (...args) => this.debug ? console.log.call(console, ...args) : null,\n            debug: (...args) => this.debug ? console.debug.call(console, ...args) : null,\n            error: (...args) => this.debug ? console.error.call(console, ...args) : null,\n        }\n    }\n\n    static isScrolledIntoView(elementNode) { // Проверка попадания блока в зону видимости\n        let rect = elementNode.getBoundingClientRect();\n        let elemTop = rect.top;\n        let elemBottom = rect.bottom;\n        let halfWindowHeight = parseInt(window.innerHeight / 2);\n        return (elemTop <= halfWindowHeight + 1 && elemBottom >= halfWindowHeight - 1); // Алгоритм подсчета можно откорректировать под себя\n    }\n\n    static debounce(func, wait) { // Уменьшение тактов вызова функции\n        let timeout;\n        return function (...args) {\n            const context = this;\n            clearTimeout(timeout);\n            timeout = setTimeout(() => func.apply(context, args), wait)\n        }\n    }\n}\n\nwindow.UrlScroll = UrlScroll; // Legacy support"],"file":"urlScroll.js"}