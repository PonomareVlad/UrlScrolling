{"version":3,"sources":["../urlScroll.mjs"],"names":["UrlScroll","rootNode","document","attribute","throttleDelay","debug","Node","querySelector","console","consoleMethods","disabledScrollEvent","window","addEventListener","routingHandler","bind","readyState","init","sectionsList","querySelectorAll","debounce","scrollEventHandler","log","sectionChanged","forEach","section","isScrolledIntoView","targetSection","getAttribute","history","state","stateData","pushState","e","error","event","disableScrollEvent","currentState","location","pathname","targetSectionNode","setTimeout","body","scrollTo","scrollIntoView","timeout","args","call","elementNode","rect","getBoundingClientRect","elemTop","top","elemBottom","bottom","innerHeight","func","wait","context","clearTimeout","apply"],"mappings":"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","sourcesContent":["export default class UrlScroll {\n\n    constructor({rootNode = document, attribute = 'id', throttleDelay = 20, debug = false} = {}) {\n        this.attribute = attribute;\n        this.throttleDelay = throttleDelay;\n        this.debug = debug;\n        this.rootNode = rootNode instanceof Node ? rootNode : document.querySelector(rootNode);\n        this.console = this.consoleMethods();\n        this.disabledScrollEvent = false;\n        window.addEventListener('popstate', this.routingHandler.bind(this));\n        if (document.readyState === 'complete') this.init();\n        else window.addEventListener('load', this.init.bind(this));\n    }\n\n    static isScrolledIntoView(elementNode) {\n        let rect = elementNode.getBoundingClientRect();\n        let elemTop = rect.top;\n        let elemBottom = rect.bottom;\n        return (elemTop >= 0) && (elemTop <= window.innerHeight / 2)//(elemBottom <= window.innerHeight);\n    }\n\n    static debounce(func, wait) {\n        let timeout;\n        return function (...args) {\n            const context = this;\n            clearTimeout(timeout);\n            timeout = setTimeout(() => func.apply(context, args), wait)\n        }\n    }\n\n    init() {\n        this.sectionsList = this.rootNode.querySelectorAll(`[${this.attribute}]`);\n        this.rootNode.addEventListener('scroll', UrlScroll.debounce(this.scrollEventHandler.bind(this), this.throttleDelay));\n        this.routingHandler();\n    }\n\n    scrollEventHandler() {\n        if (this.disabledScrollEvent) return this.console.log('Scroll event skipped');\n        let sectionChanged = false;\n        this.sectionsList.forEach(\n            section => {\n                if (sectionChanged) return;\n                if (!UrlScroll.isScrolledIntoView(section)) return;\n                let targetSection = section.getAttribute(this.attribute);\n                if (history.state && history.state.section === '' && history.state.section === targetSection) return;\n                if (history.state && history.state.section && history.state.section === targetSection) return;\n                sectionChanged = true;\n                try {\n                    let stateData = {section: targetSection};\n                    this.console.debug('PushState', stateData, targetSection);\n                    history.pushState({section: targetSection}, null, targetSection);\n                    this.console.log(`Section changed to: ${targetSection}`)\n                } catch (e) {\n                    this.console.error('Необходимо повысить значение задержки троттлинга (throttleDelay)', e)\n                }\n            }\n        )\n    }\n\n    routingHandler(event = null) {\n        // if (event && !event.state) return true;\n        // if (event) event.preventDefault();\n        this.console.debug('Routing start', event);\n        this.disableScrollEvent();\n        let currentState = event && event.state ? event.state : history.state;\n        let targetSection = currentState && currentState.section ? currentState.section : location.pathname;\n        let targetSectionNode = this.rootNode.querySelector(`[${this.attribute}=\"${targetSection}\"]`);\n        if (!targetSectionNode) return setTimeout(() => document.body.scrollTo(0, 0), 1);\n        // this.disabledScrollEvent = true;\n        setTimeout(() => targetSectionNode.scrollIntoView(), 1);\n        this.console.debug(`Scrolled to ${targetSection}`, targetSectionNode);\n        // setTimeout(() => this.disabledScrollEvent = false, this.throttleDelay * 2);\n        return true;\n    }\n\n    disableScrollEvent(timeout = this.throttleDelay * 2) {\n        this.disabledScrollEvent = true;\n        this.console.log('Scroll Event disabled');\n        setTimeout(() => {\n            this.disabledScrollEvent = false;\n            this.console.log('Scroll Event enabled')\n        }, timeout);\n    }\n\n    consoleMethods() {\n        return {\n            log: (...args) => this.debug ? console.log.call(console, ...args) : null,\n            debug: (...args) => this.debug ? console.debug.call(console, ...args) : null,\n            error: (...args) => this.debug ? console.error.call(console, ...args) : null,\n        }\n    }\n}"],"file":"urlScroll.js"}