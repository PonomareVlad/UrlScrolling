{"version":3,"sources":["../urlScroll.mjs"],"names":["UrlScroll","rootNode","document","attribute","throttleDelay","debug","disabledScrollEvent","Node","querySelector","console","consoleMethods","window","addEventListener","routingHandler","bind","readyState","init","sectionsList","querySelectorAll","debounce","scrollEventHandler","log","sectionChanged","forEach","section","isScrolledIntoView","targetSection","getAttribute","history","state","stateData","pushState","e","error","event","disableScrollEvent","currentState","location","pathname","targetSectionNode","setTimeout","body","scrollTo","scrollIntoView","timeout","args","call","elementNode","rect","getBoundingClientRect","elemTop","top","elemBottom","bottom","innerHeight","func","wait","context","clearTimeout","apply"],"mappings":"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","sourcesContent":["export default class UrlScroll {\n\n    constructor({rootNode = document, attribute = 'id', throttleDelay = 20, debug = false} = {}) {\n        // Установка переменных\n        this.attribute = attribute; // Аттрибут блока для поиска путей\n        this.throttleDelay = throttleDelay; // Задержка вызова события прокрутки\n        this.debug = debug; // Отображение лога\n        this.disabledScrollEvent = false;\n        this.rootNode = rootNode instanceof Node ? rootNode : document.querySelector(rootNode); // Выборка DOM узла, если получен селектор\n        this.console = this.consoleMethods(); // Прокси для консольных методов (Сообщения выводятся только при debug = true)\n        window.addEventListener('popstate', this.routingHandler.bind(this)); // Событие перемещения по истории (Назад, Вперед)\n        if (document.readyState === 'complete') this.init(); // Если страница уже загружена (При динамическом импорте)\n        else window.addEventListener('load', this.init.bind(this)); // Если страница загружется, ждем события onload\n    }\n\n    static isScrolledIntoView(elementNode) { // Проверка попадания блока в зону видимости\n        let rect = elementNode.getBoundingClientRect();\n        let elemTop = rect.top;\n        let elemBottom = rect.bottom;\n        // Алгоритм подсчета можно откорректировать под себя\n        return (elemTop >= 0) && (elemTop <= window.innerHeight / 2)//(elemBottom <= window.innerHeight);\n    }\n\n    static debounce(func, wait) { // Уменьшение тактов вызова функции\n        let timeout;\n        return function (...args) {\n            const context = this;\n            clearTimeout(timeout);\n            timeout = setTimeout(() => func.apply(context, args), wait)\n        }\n    }\n\n    init() {\n        this.sectionsList = this.rootNode.querySelectorAll(`[${this.attribute}]`); // Кэшируем список блоков, участвующих в смене URL\n        this.rootNode.addEventListener('scroll', UrlScroll.debounce(this.scrollEventHandler.bind(this), this.throttleDelay)); // Событие прокрутки страницы\n        this.routingHandler(); // Запуск маршрутизации\n    }\n\n    scrollEventHandler() {\n        if (this.disabledScrollEvent) return this.console.log('Scroll event skipped');\n        let sectionChanged = false;\n        this.sectionsList.forEach( // Перебираем список блоков\n            section => {\n                if (sectionChanged) return;\n                if (!UrlScroll.isScrolledIntoView(section)) return;\n                let targetSection = section.getAttribute(this.attribute); // Получаем значение аттрибута\n                if (history.state && history.state.section === '' && history.state.section === targetSection) return; // URL и значение аттрибута пустое\n                if (history.state && history.state.section && history.state.section === targetSection) return; // URL и значение аттрибута идентичны\n                sectionChanged = true;\n                try {\n                    let stateData = {section: targetSection};\n                    this.console.debug('PushState', stateData, targetSection);\n                    history.pushState({section: targetSection}, null, targetSection); // Добавляем новый шаг в историю согласно значению аттрибута\n                    this.console.log(`Section changed to: ${targetSection}`)\n                } catch (e) {\n                    this.console.error('Необходимо повысить значение задержки троттлинга (throttleDelay)', e) // Данное ограничение присутствует в Safari\n                }\n            }\n        )\n    }\n\n    routingHandler(event = null) {\n        this.console.debug('Routing start', event);\n        this.disableScrollEvent(); // Отключем событие прокрутки, чтобы не создавались лишние шаги в истории\n        let currentState = event && event.state ? event.state : history.state;\n        let targetSection = currentState && currentState.section ? currentState.section : location.pathname; // Целевой путь\n        let targetSectionNode = this.rootNode.querySelector(`[${this.attribute}=\"${targetSection}\"]`); // Блок ассоциированный с целевым путем\n        if (!targetSectionNode) return setTimeout(() => document.body.scrollTo(0, 0), 1); // Если блок не найден, возвращаемся в начало страницы\n        setTimeout(() => targetSectionNode.scrollIntoView(), 1); // Прокручиваем страницу к целевому блоку, используя отдельный поток\n        this.console.debug(`Scrolled to ${targetSection}`, targetSectionNode);\n        return true;\n    }\n\n    disableScrollEvent(timeout = this.throttleDelay * 2) { // Отключие события прокрутки\n        this.disabledScrollEvent = true;\n        this.console.log('Scroll Event disabled');\n        setTimeout(() => {\n            this.disabledScrollEvent = false;\n            this.console.log('Scroll Event enabled')\n        }, timeout);\n    }\n\n    consoleMethods() { // Прокси для консольных методов (Сообщения выводятся только при debug = true)\n        return {\n            log: (...args) => this.debug ? console.log.call(console, ...args) : null,\n            debug: (...args) => this.debug ? console.debug.call(console, ...args) : null,\n            error: (...args) => this.debug ? console.error.call(console, ...args) : null,\n        }\n    }\n}\n\nwindow.UrlScroll = UrlScroll; // Legacy support"],"file":"urlScroll.js"}